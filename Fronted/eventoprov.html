<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Evento - TEYCKETAN</title>
    <!-- Asegúrate que la ruta a tu CSS es correcta -->
    <link rel="stylesheet" href="proveedor.css"> 
</head>
<body>
    <header>
        <h1>Panel del Proveedor</h1>
        <nav>
            <ul>
                <li><a href="proveedorPanel.html">Inicio</a></li>
                <li><a href="eventoprov.html" class="activo">Crear Evento</a></li>
                <li><a href="editarprov.html">Editar Evento</a></li>
                <li><a href="estadisticas.html">Estadísticas</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section>
            <h2>Enviar Solicitud de Nuevo Evento</h2>
            <form id="create-event-form" class="form-evento">
                <label for="nombreEvento">Nombre del Evento:</label>
                <input type="text" id="nombreEvento" placeholder="Ej. Concierto Teycketan" required>

                <label for="fechaEvento">Fecha del Evento:</label>
                <input type="date" id="fechaEvento" required>

                <label for="horarioInicio">Horario de Inicio:</label>
                <input type="time" id="horarioInicio" required> <!-- Nuevo campo para Horario_Inicio -->

                <label for="horarioFin">Horario de Fin:</label>
                <input type="time" id="horarioFin" required> <!-- Nuevo campo para Horario_Fin -->

                <label for="ubicacionEvento">Ubicación:</label>
                <input type="text" id="ubicacionEvento" placeholder="Ej. Coliseo Cerrado de Lima" required>

                <label for="descripcionEvento">Descripción:</label>
                <textarea id="descripcionEvento" placeholder="Describe brevemente el evento..." required></textarea>

                <label for="precioGeneral">Precio General:</label>
                <input type="number" id="precioGeneral" placeholder="Ej. 120.00" step="0.01" required>

                <label for="precioVIP">Precio VIP:</label>
                <input type="number" id="precioVIP" placeholder="Ej. 250.00" step="0.01">

                <!-- Precio CONADIS se calcula automáticamente en el backend -->
                
                <button type="submit" class="btn-agregar">Enviar Solicitud de Evento</button>
            </form>
            <div id="message-container" style="margin-top: 20px;"></div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('create-event-form');
            const messageContainer = document.getElementById('message-container');
            const token = localStorage.getItem('jwtToken');

            if (!token) {
                alert('No estás autenticado. Por favor, inicia sesión.');
                window.location.href = 'login.html';
                return;
            }

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const nombre = document.getElementById('nombreEvento').value;
                const fecha = document.getElementById('fechaEvento').value;
                const horarioInicio = document.getElementById('horarioInicio').value; // Captura el valor de Horario_Inicio
                const horarioFin = document.getElementById('horarioFin').value;     // Captura el valor de Horario_Fin
                const ubicacion = document.getElementById('ubicacionEvento').value;
                const descripcion = document.getElementById('descripcionEvento').value;
                const precioGeneral = parseFloat(document.getElementById('precioGeneral').value);
                const precioVIP = document.getElementById('precioVIP').value ? parseFloat(document.getElementById('precioVIP').value) : null;
                
                messageContainer.innerHTML = '';

                try {
                    const response = await fetch('http://localhost:3000/api/proveedor/eventos/crear', { 
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ 
                            nombre, 
                            fecha, 
                            horarioInicio, // Envía Horario_Inicio
                            horarioFin,    // Envía Horario_Fin
                            ubicacion, 
                            descripcion, 
                            precioGeneral, 
                            precioVIP
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        messageContainer.innerHTML = `<p style="color: green;">${data.message || 'Solicitud de evento enviada con éxito y pendiente de aprobación.'}</p>`;
                        form.reset();
                    } else {
                        messageContainer.innerHTML = `<p style="color: red;">Error: ${data.error || data.message || 'Error al enviar la solicitud de evento.'}</p>`;
                    }
                } catch (error) {
                    console.error('Error al enviar la solicitud de evento:', error);
                    messageContainer.innerHTML = `<p style="color: red;">Error de conexión o del servidor al enviar solicitud.</p>`;
                }
            });
        });
    </script>
</body>
</html>
